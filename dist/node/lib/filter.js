"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function filterSync(e,t,r){var n=new FilterStateInternal;return executeFilter(e,t,n,r)}function filterAsync(e,t,r,n){var i=new FilterStateInternal,s=new FilterState(i),o=function(){r(executeFilter(e,t,i,n),s)};return"function"==typeof setImmediate?setImmediate(o):setTimeout(o,0),s}function executeFilter(e,t,r,n){if(r.shouldAbort)return[];var i=n.key,s=n.maxResults,o=n.outputScore,c=n.usePathScoring,l=c?_pathScorer2.default:_scorer2.default,u=null;null!=i&&(u=_utils2.default.isFunction(n.key)?n.key:function(e){return e[i]}),r.isActive=!0,r.accessor=u,r.scoreProvider=l,r.scoredCandidates=[],processCollection(e,t,r,n);var a=r.scoredCandidates;return r.scoredCandidates=null,r.isActive=!1,r.shouldAbort||null==a||!a.length?[]:(a.sort(sortCandidates),null!=s&&(a=a.slice(0,s)),o===!0?a:a.map(pluckCandidates))}function processCollection(e,t,r,n){if(_utils2.default.isArray(e))for(var i=0;i<=e.length&&processItem(e[i],t,r,n);i++);else{var s=_utils2.default.getIterator(e);if(null==s){var o=!0;_utils2.default.isFunction(e.forEach)&&e.forEach(function(e){return o=o&&processItem(e,t,r,n)})}else for(var c=void 0;(c=s.next())&&!c.done&&processItem(c.value,t,r,n););}}function processItem(e,t,r,n){if(r.shouldAbort)return!1;r.count++;var i=r.accessor,s=r.scoredCandidates,o=r.scoreProvider,c=null!=i?i(e):e;if(null==c||!c.length)return!0;var l=o.score(c,t,n);return l>0&&s.push({candidate:e,score:l}),!0}function pluckCandidates(e){return e.candidate}function sortCandidates(e,t){return t.score-e.score}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FilterState=void 0,exports.filterSync=filterSync,exports.filterAsync=filterAsync;var _scorer=require("./scorer"),_scorer2=_interopRequireDefault(_scorer),_pathScorer=require("./pathScorer"),_pathScorer2=_interopRequireDefault(_pathScorer),_utils=require("./utils"),_utils2=_interopRequireDefault(_utils);exports.default={filterSync:filterSync,filterAsync:filterAsync};var FilterStateInternal=function e(){_classCallCheck(this,e),this.isActive=!1,this.shouldAbort=!1,this.count=0,this.scoredCandidates=null,this.accessor=null,this.scoreProvider=null},FilterState=exports.FilterState=function e(t){_classCallCheck(this,e),this.abort=function(){t.isActive=!1,t.shouldAbort=!0},this.isActive=function(){return t.isActive},this.isCanceled=function(){return t.shouldAbort},this.getProgressCount=function(){return t.count}};