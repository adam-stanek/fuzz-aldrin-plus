"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function filterSync(e,t,r){var n=new _filterState.FilterStateInternal;return executeFilter(e,t,n,r)}function filterAsync(e,t,r,n){var i=new _filterState.FilterStateInternal,u=new _filterState.FilterState(i),s=function(){r(executeFilter(e,t,i,n),u)};return"function"==typeof setImmediate?setImmediate(s):setTimeout(s,0),u}function executeFilter(e,t,r,n){if(r.shouldAbort)return[];var i=n.key,u=n.maxResults,s=n.outputScore,l=n.usePathScoring,o=null;null!=i&&(o=_utils2.default.isFunction(n.key)?n.key:function(e){return e[i]}),r.isActive=!0,r.accessor=o,r.scoreProvider=l?_pathScorer2.default:_scorer2.default,r.scoredCandidates=[],processCollection(e,t,r,n);var a=r.scoredCandidates;return r.scoredCandidates=null,r.isActive=!1,r.discardResults||null==a||!a.length?[]:(a.sort(sortCandidates),null!=u&&(a=a.slice(0,u)),s===!0?a:a.map(pluckCandidates))}function processCollection(e,t,r,n){if(_utils2.default.isArray(e)){for(var i=0;i<=e.length&&processItem(e[i],t,r,n);i++);return!0}var u=_utils2.default.getIterator(e);if(null!=u){var s=u.next();if(_utils2.default.isIteratorItem(s)){for(;!s.done&&processItem(s.value,t,r,n);)s=u.next();return!0}}var l=!0;return!!_utils2.default.isFunction(e.forEach)&&(e.forEach(function(e){return l=l&&processItem(e,t,r,n)}),!0)}function processItem(e,t,r,n){if(r.shouldAbort)return!1;r.count++;var i=r.accessor,u=r.scoredCandidates,s=r.scoreProvider,l=null!=i?i(e):e;if(null==l||!l.length)return!0;var o=s.score(l,t,n);return o>0&&u.push({candidate:e,score:o}),!0}function pluckCandidates(e){return e.candidate}function sortCandidates(e,t){return t.score-e.score}Object.defineProperty(exports,"__esModule",{value:!0}),exports.filterSync=filterSync,exports.filterAsync=filterAsync;var _scorer=require("./scorer"),_scorer2=_interopRequireDefault(_scorer),_pathScorer=require("./pathScorer"),_pathScorer2=_interopRequireDefault(_pathScorer),_utils=require("./utils"),_utils2=_interopRequireDefault(_utils),_filterState=require("./filterState");exports.default={filterSync:filterSync,filterAsync:filterAsync};