"use strict";function match(r,e,t){var a=t.allowErrors,s=t.preparedQuery,o=t.pathSeparator;if(!a&&!(0,_scorer.isMatch)(r,s.core_lw,s.core_up))return[];var c=r.toLowerCase(),n=computeMatch(r,c,s);if(0===n.length)return n;if(r.indexOf(o)>-1){var u=basenameMatch(r,c,s,o);n=mergeMatches(n,u)}return n}function wrap(r,e,t){var a=t.tagClass||"highlight",s=t.tagOpen||'<strong class="'+a+'">',o=t.tagClose||"</strong>";if(r===t.preparedQuery.query)return s+r+o;var c=match(r,e,t),n=c.length;if(0===n)return r;for(var u="",i=-1,h=0;++i<n;){var f=c[i];for(f>h&&(u+=r.substring(h,f),h=f);++i<n;){if(c[i]!==f+1){i--;break}f++}f++,f>h&&(u+=s,u+=r.substring(h,f),u+=o,h=f)}return h<r.length-1&&(u+=r.substring(h)),u}function basenameMatch(r,e,t,a){for(var s=r.length-1;r[s]===a;)s--;var o=r.lastIndexOf(a,s);if(o===-1)return[];for(var c=t.depth;c-- >0;)if(o=r.lastIndexOf(a,o-1),o===-1)return[];return o++,s++,computeMatch(r.slice(o,s),e.slice(o,s),t,o)}function mergeMatches(r,e){var t=r.length,a=e.length;if(0===a)return r.slice();if(0===t)return e.slice();for(var s=-1,o=0,c=e[o],n=[];++s<t;){for(var u=r[s];c<=u&&++o<a;)c<u&&n.push(c),c=e[o];n.push(u)}for(;o<a;)n.push(e[o++]);return n}function computeMatch(r,e,t){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=t.query,o=t.query_lw,c=r.length,n=s.length,u=(0,_scorer.scoreAcronyms)(r,e,s,o).score,i=new Array(n),h=new Array(n),f=0,v=1,l=2,p=3,g=new Array(c*n),d=-1,m=-1;++m<n;)i[m]=0,h[m]=0;for(var w=void 0,_=void 0,b=void 0,y=void 0,M=void 0,x=-1;++x<c;){b=0,y=0,M=0;var C=e[x];for(m=-1;++m<n;){var O=0,k=0;if(_=y,o[m]===C){var q=(0,_scorer.isWordStart)(x,r,e);O=M>0?M:(0,_scorer.scoreConsecutives)(r,e,s,o,x,m,q),k=_+(0,_scorer.scoreCharacter)(x,m,q,u,O)}y=i[m],M=h[m],b>y?w=l:(b=y,w=v),k>b?(b=k,w=p):O=0,i[m]=b,h[m]=O,g[++d]=b>0?w:f}}x=c-1,m=n-1,d=x*n+m;for(var A=!0,I=[];A&&x>=0&&m>=0;)switch(g[d]){case v:x--,d-=n;break;case l:m--,d--;break;case p:I.push(x+a),m--,x--,d-=n+1;break;default:A=!1}return I.reverse(),I}Object.defineProperty(exports,"__esModule",{value:!0}),exports.match=match,exports.wrap=wrap;var _scorer=require("./scorer");exports.default={match:match,wrap:wrap};