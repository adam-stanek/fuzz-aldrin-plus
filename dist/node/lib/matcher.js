"use strict";function match(r,e,t){var a=t.allowErrors,s=t.preparedQuery,o=t.pathSeparator;if(!a&&!(0,_scorer.isMatch)(r,s.core_lw,s.core_up))return[];var n=r.toLowerCase(),c=computeMatch(r,n,s);if(0===c.length)return c;if(r.indexOf(o)>-1){var i=basenameMatch(r,n,s,o);c=mergeMatches(c,i)}return c}function wrap(r,e,t){var a=t.tagClass||"highlight",s=t.tagOpen||'<strong class="'+a+'">',o=t.tagClose||"</strong>";if(r===e)return s+r+o;var n=match(r,e,t);if(0===n.length)return r;for(var c="",i=-1,u=0;++i<n.length;){var h=n[i];for(h>u&&(c+=r.substring(u,h),u=h);++i<n.length;){if(n[i]!==h+1){i--;break}h++}h++,h>u&&(c+=s,c+=r.substring(u,h),c+=o,u=h)}return u<r.length-1&&(c+=r.substring(u)),c}function basenameMatch(r,e,t,a){for(var s=r.length-1;r[s]===a;)s--;var o=r.lastIndexOf(a,s);if(o===-1)return[];for(var n=t.depth;n-- >0;)if(o=r.lastIndexOf(a,o-1),o===-1)return[];return o++,s++,computeMatch(r.slice(o,s),e.slice(o,s),t,o)}function mergeMatches(r,e){var t=r.length,a=e.length;if(0===a)return r.slice();if(0===t)return e.slice();for(var s=-1,o=0,n=e[o],c=[];++s<t;){for(var i=r[s];n<=i&&++o<a;)n<i&&c.push(n),n=e[o];c.push(i)}for(;o<a;)c.push(e[o++]);return c}function computeMatch(r,e,t){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=t.query,o=t.query_lw,n=r.length,c=s.length,i=(0,_scorer.scoreAcronyms)(r,e,s,o).score,u=new Array(c),h=new Array(c),f=0,l=1,v=2,p=3,g=new Array(n*c),d=-1,m=-1;++m<c;)u[m]=0,h[m]=0;for(var w=void 0,_=void 0,b=void 0,M=void 0,y=void 0,x=-1;++x<n;){b=0,M=0,y=0;var C=e[x];for(m=-1;++m<c;){var O=0,k=0;if(_=M,o[m]===C){var A=(0,_scorer.isWordStart)(x,r,e);O=y>0?y:(0,_scorer.scoreConsecutives)(r,e,s,o,x,m,A),k=_+(0,_scorer.scoreCharacter)(x,m,A,i,O)}M=u[m],y=h[m],b>M?w=v:(b=M,w=l),k>b?(b=k,w=p):O=0,u[m]=b,h[m]=O,g[++d]=b>0?w:f}}x=n-1,m=c-1,d=x*c+m;for(var q=!0,I=[];q&&x>=0&&m>=0;)switch(g[d]){case l:x--,d-=c;break;case v:m--,d--;break;case p:I.push(x+a),m--,x--,d-=c+1;break;default:q=!1}return I.reverse(),I}Object.defineProperty(exports,"__esModule",{value:!0}),exports.match=match,exports.wrap=wrap;var _scorer=require("./scorer");exports.default={match:match,wrap:wrap};