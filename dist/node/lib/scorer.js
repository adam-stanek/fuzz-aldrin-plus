"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function score(r,e,t){var o=t.preparedQuery,s=t.allowErrors;if(!s&&!isMatch(r,o.core_lw,o.core_up))return 0;var c=r.toLowerCase(),n=computeScore(r,c,o);return Math.ceil(n)}function isMatch(r,e,t){var o=r.length,s=e.length;if(!o||s>o)return!1;for(var c=-1,n=-1;++n<s;){for(var a=e.charCodeAt(n),i=t.charCodeAt(n);++c<o;){var u=r.charCodeAt(c);if(u===a||u===i)break}if(c===o)return!1}return!0}function computeScore(r,e,t){var o=t.query,s=t.query_lw,c=r.length,n=o.length,a=0,i=scoreAcronyms(r,e,o,s),u=i.score;if(i.count===n)return scoreExact(n,c,u,i.pos);var f=e.indexOf(s);if(f>-1)return scoreExactMatch(r,e,o,s,f,n,c);for(var l=new Array(n),v=new Array(n),h=scoreSize(n,c),p=Math.ceil(miss_coeff*n)+5,d=p,x=-1;++x<n;)l[x]=0,v[x]=0;var m=e.indexOf(s[0]);m>-1&&m--;var S=e.lastIndexOf(s[n-1],c);S>m&&(c=S+1);for(var y=!0;++m<c;){var C=e[m];if(null!=t.charCodes[C.charCodeAt(0)]){a=0;var A=0,_=0,E=!0;for(y=!1,x=-1;++x<n;){var M=l[x];M>a&&(a=M);var W=0;if(s[x]===C){var w=isWordStart(m,r,e);W=_>0?_:scoreConsecutives(r,e,o,s,m,x,w);var P=A+scoreCharacter(m,x,w,u,W);if(P>a)a=P,d=p;else{if(E&&--d<=0)return l[n-1]*h;E=!1}}A=M,_=v[x],v[x]=W,l[x]=a}}else if(y!==!0){for(x=-1;++x<n;)v[x]=0;y=!0}}return a=l[n-1],a*h}function isWordStart(r,e,t){if(0===r)return!0;var o=e[r],s=e[r-1];return isSeparator(s)||o!==t[r]&&s===t[r-1]}function isWordEnd(r,e,t,o){if(r===o-1)return!0;var s=e[r],c=e[r+1];return isSeparator(c)||s===t[r]&&c!==t[r+1]}function isSeparator(r){return" "===r||"."===r||"-"===r||"_"===r||"/"===r||"\\"===r}function scorePosition(r){if(r<pos_bonus){var e=pos_bonus-r;return 100+e*e}return Math.max(100+pos_bonus-r,0)}function scoreSize(r,e){return tau_size/(tau_size+Math.abs(e-r))}function scoreExact(r,e,t,o){return 2*r*(wm*t+scorePosition(o))*scoreSize(r,e)}function scorePattern(r,e,t,o,s){var c=r,n=6;return t===r&&(n+=2),o&&(n+=3),s&&(n+=1),r===e&&(o&&(c+=t===e?2:1),s&&(n+=1)),t+c*(c+n)}function scoreCharacter(r,e,t,o,s){var c=scorePosition(r);return t?c+wm*((o>s?o:s)+10):c+wm*s}function scoreConsecutives(r,e,t,o,s,c,n){var a=r.length,i=t.length,u=a-s,f=i-c,l=u<f?u:f,v=0,h=0;for(t[c]===r[s]&&v++;++h<l&&o[++c]===e[++s];)t[c]===r[s]&&v++;return 1===h?1+2*v:scorePattern(h,i,v,n,isWordEnd(s,r,e,a))}function scoreExactMatch(r,e,t,o,s,c,n){var a=isWordStart(s,r,e);if(!a){var i=e.indexOf(o,s+1);i>-1&&(a=isWordStart(i,r,e),a&&(s=i))}for(var u=-1,f=0;++u<c;)t[s+u]===r[u]&&f++;var l=isWordEnd(s+c-1,r,e,n);return scoreExact(c,n,scorePattern(c,c,f,a,l),s)}function scoreAcronyms(r,e,t,o){var s=r.length,c=t.length;if(s<=1||c<=1)return emptyAcronymResult;for(var n=0,a=0,i=0,u=0,f=-1,l=-1;++l<c;){var v=o[l];if(isSeparator(v)){if(f=e.indexOf(v,f+1),f>-1){a++;continue}break}for(;++f<s;)if(v===e[f]&&isWordStart(f,r,e)){t[l]===r[f]&&u++,i+=f,n++;break}if(f===s)break}if(n<2)return emptyAcronymResult;var h=n===c&&isAcronymFullWord(r,e,t,n),p=scorePattern(n,c,u,!0,h);return new AcronymResult(p,i/n,n+a)}function isAcronymFullWord(r,e,t,o){var s=r.length,c=t.length,n=0;if(s>12*c)return!1;for(var a=-1;++a<s;)if(isWordStart(a,r,e)&&++n>o)return!1;return!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.score=score,exports.isMatch=isMatch,exports.computeScore=computeScore,exports.isWordStart=isWordStart,exports.isWordEnd=isWordEnd,exports.isSeparator=isSeparator,exports.scorePosition=scorePosition,exports.scoreSize=scoreSize,exports.scoreExact=scoreExact,exports.scorePattern=scorePattern,exports.scoreCharacter=scoreCharacter,exports.scoreConsecutives=scoreConsecutives,exports.scoreExactMatch=scoreExactMatch,exports.scoreAcronyms=scoreAcronyms;var wm=150,pos_bonus=20,tau_size=85,miss_coeff=.75;exports.default={score:score,isMatch:isMatch};var AcronymResult=function r(e,t,o){_classCallCheck(this,r),this.score=e,this.pos=t,this.count=o},emptyAcronymResult=new AcronymResult(0,.1,0);