"use strict";function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function score(r,e,t){var o=t.preparedQuery,s=t.allowErrors;if(!s&&!isMatch(r,o.core_lw,o.core_up))return 0;var c=r.toLowerCase(),a=computeScore(r,c,t);return Math.ceil(a)}function isMatch(r,e,t){var o=r.length,s=e.length;if(!o||s>o)return!1;for(var c=-1,a=-1;++a<s;){for(var n=e.charCodeAt(a),i=t.charCodeAt(a);++c<o;){var u=r.charCodeAt(c);if(u===n||u===i)break}if(c===o)return!1}return!0}function computeScore(r,e,t){var o=t.preparedQuery,s=o.query,c=o.query_lw,a=!0,n=r.length,i=s.length,u=0,f=scoreAcronyms(r,e,s,c),v=f.score;if(f.count===i)return scoreExact(i,n,v,f.pos);var l=e.indexOf(c);if(l>-1)return scoreExactMatch(r,e,s,c,l,i,n);for(var p=new Array(i),h=new Array(i),d=scoreSize(i,n),x=Math.ceil(miss_coeff*i)+5,m=x,y=-1;++y<i;)p[y]=0,h[y]=0;var S=e.indexOf(c[0]);S>-1&&S--;var C=e.lastIndexOf(c[i-1],n);C>S&&(n=C+1);for(var A=!0;++S<n;){var _=e[S];if(null!=o.charCodes[_.charCodeAt(0)]){var E=e[S];u=0;var M=0,W=0,w=!0;for(A=!1,y=-1;++y<i;){var P=p[y];P>u&&(u=P);var b=0,g=c[y];if(g===_){var z=s[y];if(a||g===z||E===z){var k=isWordStart(S,r,e);b=W>0?W:scoreConsecutives(r,e,s,c,S,y,k);var O=M+scoreCharacter(S,y,k,v,b);if(O>u)u=O,m=x;else{if(w&&--m<=0)return p[i-1]*d;w=!1}}}M=P,W=h[y],h[y]=b,p[y]=u}}else if(A!==!0){for(y=-1;++y<i;)h[y]=0;A=!0}}return u=p[i-1],u*d}function isWordStart(r,e,t){if(0===r)return!0;var o=e[r],s=e[r-1];return isSeparator(s)||o!==t[r]&&s===t[r-1]}function isWordEnd(r,e,t,o){if(r===o-1)return!0;var s=e[r],c=e[r+1];return isSeparator(c)||s===t[r]&&c!==t[r+1]}function isSeparator(r){return" "===r||"."===r||"-"===r||"_"===r||"/"===r||"\\"===r}function scorePosition(r){if(r<pos_bonus){var e=pos_bonus-r;return 100+e*e}return Math.max(100+pos_bonus-r,0)}function scoreSize(r,e){return tau_size/(tau_size+Math.abs(e-r))}function scoreExact(r,e,t,o){return 2*r*(wm*t+scorePosition(o))*scoreSize(r,e)}function scorePattern(r,e,t,o,s){var c=r,a=6;return t===r&&(a+=2),o&&(a+=3),s&&(a+=1),r===e&&(o&&(c+=t===e?2:1),s&&(a+=1)),t+c*(c+a)}function scoreCharacter(r,e,t,o,s){var c=scorePosition(r);return t?c+wm*((o>s?o:s)+10):c+wm*s}function scoreConsecutives(r,e,t,o,s,c,a){var n=r.length,i=t.length,u=n-s,f=i-c,v=u<f?u:f,l=0;t[c]===r[s]&&l++;for(var p=0;++p<v&&o[++c]===e[++s];)t[c]===r[s]&&l++;return 1===p?1+2*l:scorePattern(p,i,l,a,isWordEnd(s,r,e,n))}function scoreExactMatch(r,e,t,o,s,c,a){var n=isWordStart(s,r,e);if(!n){var i=e.indexOf(o,s+1);i>-1&&(n=isWordStart(i,r,e),n&&(s=i))}for(var u=-1,f=0;++u<c;)t[s+u]===r[u]&&f++;var v=isWordEnd(s+c-1,r,e,a);return scoreExact(c,a,scorePattern(c,c,f,n,v),s)}function scoreAcronyms(r,e,t,o){var s=r.length,c=t.length;if(s<=1||c<=1)return emptyAcronymResult;for(var a=0,n=0,i=0,u=0,f=-1,v=-1;++v<c;){var l=o[v];if(isSeparator(l)){if(f=e.indexOf(l,f+1),f>-1){n++;continue}break}for(;++f<s;)if(l===e[f]&&isWordStart(f,r,e)){t[v]===r[f]&&u++,i+=f,a++;break}if(f===s)break}if(a<2)return emptyAcronymResult;var p=a===c&&isAcronymFullWord(r,e,t,a),h=scorePattern(a,c,u,!0,p);return new AcronymResult(h,i/a,a+n)}function isAcronymFullWord(r,e,t,o){var s=r.length,c=t.length,a=0;if(s>12*c)return!1;for(var n=-1;++n<s;)if(isWordStart(n,r,e)&&++a>o)return!1;return!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.score=score,exports.isMatch=isMatch,exports.computeScore=computeScore,exports.isWordStart=isWordStart,exports.isWordEnd=isWordEnd,exports.isSeparator=isSeparator,exports.scorePosition=scorePosition,exports.scoreSize=scoreSize,exports.scoreExact=scoreExact,exports.scorePattern=scorePattern,exports.scoreCharacter=scoreCharacter,exports.scoreConsecutives=scoreConsecutives,exports.scoreExactMatch=scoreExactMatch,exports.scoreAcronyms=scoreAcronyms;var wm=150,pos_bonus=20,tau_size=85,miss_coeff=.75;exports.default={score:score,isMatch:isMatch};var AcronymResult=function r(e,t,o){_classCallCheck(this,r),this.score=e,this.pos=t,this.count=o},emptyAcronymResult=new AcronymResult(0,.1,0);